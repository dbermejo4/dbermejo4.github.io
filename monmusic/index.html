<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart, Crescent Moon, and Rainbow Animation</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #0d335f;
            margin: 0;
        }
        canvas {
            border: 2px solid white;
        }
        .plyr {
            margin-top: 20px;
        }
    </style>

    <!-- Include Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
</head>
<body>

<input type="file" id="audio-upload" accept="audio/*" />
<select id="shape-selector">
    <option value="heart">Heart</option>
    <option value="moon">Crescent Moon</option>
    <option value="rainbow">Rainbow</option>
</select>

<!-- Audio element for Plyr -->
<audio id="player" controls></audio>

<!-- Include Plyr JS -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>

<script>
let amplitude, fft;
let song;
let shapes = []; // Array de posicions de les formes
let numShapes = 10; // Nombre de formes a dibuixar
let selectedShape = 'heart'; // Forma per defecte

function setup() {
  let canvas = createCanvas(600, 600);
  canvas.parent(document.body);

  amplitude = new p5.Amplitude();
  fft = new p5.FFT();

  // Inicialitzar les formes amb posicions aleatòries
  for (let i = 0; i < numShapes; i++) {
    let x = random(width);
    let y = random(height);
    shapes.push({x: x, y: y});
  }

  // Setup file input listener
  let fileInput = document.getElementById('audio-upload');
  fileInput.addEventListener('change', handleFileUpload);

  // Dropdown listener
  let shapeSelector = document.getElementById('shape-selector');
  shapeSelector.addEventListener('change', function() {
    selectedShape = this.value;
  });
}

function draw() {
  background('#0d335f');

  if (!song || !song.isPlaying()) {
    return;
  }

  let level = amplitude.getLevel();
  let size = map(level, 0, 1, 0.5, 1.5); // Escala de la mida de la forma

  let spectrum = fft.analyze();
  let bass = fft.getEnergy("bass");
  let treble = fft.getEnergy("treble");

  let r = map(bass, 0, 255, 50, 255);
  let b = map(treble, 0, 255, 50, 255);
  let g = map(level, 0, 1, 50, 255);

  noFill();
  stroke(r, g, b);
  strokeWeight(3);

  // Dibuixar múltiples formes (cors, llunes o arcs de Sant Martí)
  shapes.forEach(shape => {
    push();
    translate(shape.x, shape.y);
    scale(size);

    if (selectedShape === 'heart') {
      drawHeart(); // Dibuixa el cor
    } else if (selectedShape === 'moon') {
      drawCrescentMoon(); // Dibuixa la lluna creixent
    } else if (selectedShape === 'rainbow') {
      drawRainbow(); // Dibuixa l'arc de Sant Martí
    }

    pop();
  });
}

function drawHeart() {
function draw() {
  background(200);
  fill(255,0,100)
  beginShape();
vertex(343, 117.1875);
vertex(345, 112.1875);
vertex(345, 107.1875);
vertex(345, 103.1875);
vertex(343, 98.1875);
vertex(341, 94.1875);
vertex(338, 90.1875);
vertex(335, 86.1875);
vertex(332, 81.1875);
vertex(329, 78.1875);
vertex(324, 74.1875);
vertex(320, 71.1875);
vertex(314, 67.1875);
vertex(310, 65.1875);
vertex(305, 63.1875);
vertex(299, 60.1875);
vertex(293, 57.1875);
vertex(287, 55.1875);
vertex(282, 54.1875);
vertex(276, 53.1875);
vertex(269, 53.1875);
vertex(262, 55.1875);
vertex(256, 55.1875);
vertex(250, 55.1875);
vertex(246, 56.1875);
vertex(241, 58.1875);
vertex(238, 60.1875);
vertex(231, 63.1875);
vertex(225, 66.1875);
vertex(217, 70.1875);
vertex(211, 74.1875);
vertex(206, 78.1875);
vertex(201, 82.1875);
vertex(196, 86.1875);
vertex(192, 90.1875);
vertex(189, 93.1875);
vertex(185, 97.1875);
vertex(180, 101.1875);
vertex(174, 106.1875);
vertex(169, 111.1875);
vertex(164, 118.1875);
vertex(158, 123.1875);
vertex(156, 127.1875);
vertex(153, 131.1875);
vertex(150, 135.1875);
vertex(147, 139.1875);
vertex(145, 143.1875);
vertex(142, 147.1875);
vertex(139, 151.1875);
vertex(135, 157.1875);
vertex(132, 164.1875);
vertex(129, 169.1875);
vertex(127, 173.1875);
vertex(124, 178.1875);
vertex(120, 184.1875);
vertex(118, 189.1875);
vertex(115, 196.1875);
vertex(112, 201.1875);
vertex(110, 205.1875);
vertex(108, 212.1875);
vertex(106, 215.1875);
vertex(103, 222.1875);
vertex(101, 227.1875);
vertex(98, 235.1875);
vertex(96, 242.1875);
vertex(94, 249.1875);
vertex(92, 254.1875);
vertex(89, 261.1875);
vertex(88, 268.1875);
vertex(86, 274.1875);
vertex(84, 280.1875);
vertex(82, 288.1875);
vertex(81, 295.1875);
vertex(80, 300.1875);
vertex(78, 306.1875);
vertex(76, 315.1875);
vertex(74, 324.1875);
vertex(72, 330.1875);
vertex(72, 336.1875);
vertex(71, 342.1875);
vertex(70, 348.1875);
vertex(68, 353.1875);
vertex(68, 357.1875);
vertex(67, 362.1875);
vertex(66, 369.1875);
vertex(67, 375.1875);
vertex(67, 380.1875);
vertex(67, 387.1875);
vertex(70, 393.1875);
vertex(73, 397.1875);
vertex(78, 400.1875);
vertex(81, 401.1875);
vertex(87, 401.1875);
vertex(90, 399.1875);
vertex(92, 396.1875);
vertex(92, 393.1875);
vertex(92, 390.1875);
vertex(94, 386.1875);
vertex(96, 380.1875);
vertex(97, 374.1875);
vertex(99, 368.1875);
vertex(100, 363.1875);
vertex(101, 357.1875);
vertex(103, 351.1875);
vertex(104, 341.1875);
vertex(106, 333.1875);
vertex(109, 325.1875);
vertex(111, 317.1875);
vertex(113, 306.1875);
vertex(114, 300.1875);
vertex(115, 297.1875);
vertex(117, 292.1875);
vertex(118, 284.1875);
vertex(120, 279.1875);
vertex(123, 273.1875);
vertex(124, 267.1875);
vertex(125, 261.1875);
vertex(127, 257.1875);
vertex(129, 252.1875);
vertex(132, 246.1875);
vertex(134, 238.1875);
vertex(135, 235.1875);
vertex(137, 228.1875);
vertex(140, 224.1875);
vertex(144, 219.1875);
vertex(145, 214.1875);
vertex(148, 209.1875);
vertex(151, 202.1875);
vertex(152, 198.1875);
vertex(157, 192.1875);
vertex(160, 186.1875);
vertex(162, 183.1875);
vertex(165, 179.1875);
vertex(167, 175.1875);
vertex(169, 171.1875);
vertex(171, 166.1875);
vertex(175, 162.1875);
vertex(177, 158.1875);
vertex(180, 154.1875);
vertex(183, 150.1875);
vertex(186, 145.1875);
vertex(190, 141.1875);
vertex(195, 135.1875);
vertex(199, 130.1875);
vertex(204, 125.1875);
vertex(208, 120.1875);
vertex(215, 113.1875);
vertex(220, 109.1875);
vertex(225, 106.1875);
vertex(228, 103.1875);
vertex(232, 100.1875);
vertex(235, 98.1875);
vertex(240, 96.1875);
vertex(244, 95.1875);
vertex(251, 92.1875);
vertex(255, 89.1875);
vertex(260, 88.1875);
vertex(266, 88.1875);
vertex(272, 87.1875);
vertex(276, 87.1875);
vertex(281, 88.1875);
vertex(285, 90.1875);
vertex(289, 90.1875);
vertex(293, 92.1875);
vertex(295, 93.1875);
vertex(298, 95.1875);
vertex(300, 98.1875);
vertex(302, 100.1875);
vertex(305, 103.1875);
vertex(307, 105.1875);
vertex(310, 109.1875);
vertex(312, 111.1875);
vertex(314, 112.1875);
vertex(316, 114.1875);
vertex(318, 116.1875);
vertex(321, 118.1875);
vertex(323, 120.1875);
vertex(326, 122.1875);
vertex(330, 120.1875);
vertex(334, 120.1875);
vertex(337, 119.1875);
vertex(340, 117.1875);
vertex(342, 116.1875);
endShape();
  fill(255, 255, 0)
  beginShape();
vertex(351, 231.1875);
vertex(354, 230.1875);
vertex(357, 229.1875);
vertex(362, 225.1875);
vertex(364, 221.1875);
vertex(365, 216.1875);
vertex(365, 211.1875);
vertex(365, 207.1875);
vertex(363, 202.1875);
vertex(360, 198.1875);
vertex(358, 195.1875);
vertex(354, 190.1875);
vertex(350, 186.1875);
vertex(345, 181.1875);
vertex(340, 178.1875);
vertex(334, 176.1875);
vertex(328, 174.1875);
vertex(321, 173.1875);
vertex(315, 172.1875);
vertex(308, 172.1875);
vertex(301, 172.1875);
vertex(295, 173.1875);
vertex(287, 174.1875);
vertex(280, 176.1875);
vertex(273, 180.1875);
vertex(267, 182.1875);
vertex(260, 186.1875);
vertex(253, 189.1875);
vertex(247, 193.1875);
vertex(241, 198.1875);
vertex(236, 201.1875);
vertex(230, 205.1875);
vertex(225, 209.1875);
vertex(220, 214.1875);
vertex(220, 214.1875);
vertex(216, 218.1875);
vertex(212, 222.1875);
vertex(207, 226.1875);
vertex(201, 233.1875);
vertex(196, 239.1875);
vertex(193, 245.1875);
vertex(188, 250.1875);
vertex(184, 257.1875);
vertex(180, 264.1875);
vertex(177, 271.1875);
vertex(174, 277.1875);
vertex(170, 284.1875);
vertex(166, 293.1875);
vertex(165, 300.1875);
vertex(162, 308.1875);
vertex(160, 313.1875);
vertex(158, 321.1875);
vertex(155, 329.1875);
vertex(154, 338.1875);
vertex(154, 350.1875);
vertex(153, 359.1875);
vertex(151, 370.1875);
vertex(151, 378.1875);
vertex(153, 388.1875);
vertex(154, 396.1875);
vertex(159, 402.1875);
vertex(166, 407.1875);
vertex(173, 407.1875);
vertex(178, 400.1875);
vertex(181, 393.1875);
vertex(184, 388.1875);
vertex(186, 378.1875);
vertex(187, 368.1875);
vertex(188, 357.1875);
vertex(190, 344.1875);
vertex(193, 335.1875);
vertex(195, 326.1875);
vertex(198, 318.1875);
vertex(200, 311.1875);
vertex(203, 301.1875);
vertex(208, 294.1875);
vertex(208, 294.1875);
vertex(212, 282.1875);
vertex(215, 277.1875);
vertex(220, 272.1875);
vertex(225, 264.1875);
vertex(233, 254.1875);
vertex(241, 243.1875);
vertex(249, 237.1875);
vertex(255, 231.1875);
vertex(261, 227.1875);
vertex(270, 221.1875);
vertex(279, 214.1875);
vertex(289, 208.1875);
vertex(299, 205.1875);
vertex(309, 204.1875);
vertex(317, 204.1875);
vertex(323, 208.1875);
vertex(330, 215.1875);
vertex(336, 221.1875);
vertex(338, 227.1875);
vertex(347, 231.1875);
endShape();
  fill(0,210,0)
  beginShape();
vertex(384, 319.1875);
vertex(387, 312.1875);
vertex(388, 308.1875);
vertex(387, 301.1875);
vertex(385, 296.1875);
vertex(381, 291.1875);
vertex(378, 286.1875);
vertex(375, 282.1875);
vertex(368, 277.1875);
vertex(362, 274.1875);
vertex(356, 272.1875);
vertex(352, 271.1875);
vertex(343, 268.1875);
vertex(336, 268.1875);
vertex(329, 270.1875);
vertex(323, 271.1875);
vertex(317, 273.1875);
vertex(311, 277.1875);
vertex(304, 281.1875);
vertex(299, 285.1875);
vertex(293, 291.1875);
vertex(286, 298.1875);
vertex(280, 304.1875);
vertex(274, 312.1875);
vertex(268, 318.1875);
vertex(264, 327.1875);
vertex(259, 336.1875);
vertex(255, 344.1875);
vertex(251, 352.1875);
vertex(247, 362.1875);
vertex(244, 371.1875);
vertex(241, 379.1875);
vertex(238, 390.1875);
vertex(235, 397.1875);
vertex(232, 407.1875);
vertex(232, 415.1875);
vertex(234, 426.1875);
vertex(238, 431.1875);
vertex(249, 433.1875);
vertex(257, 428.1875);
vertex(261, 417.1875);
vertex(267, 405.1875);
vertex(271, 395.1875);
vertex(275, 384.1875);
vertex(282, 371.1875);
vertex(286, 363.1875);
vertex(289, 357.1875);
vertex(294, 350.1875);
vertex(298, 344.1875);
vertex(303, 338.1875);
vertex(307, 331.1875);
vertex(313, 324.1875);
vertex(320, 318.1875);
vertex(324, 313.1875);
vertex(331, 307.1875);
vertex(339, 303.1875);
vertex(348, 304.1875);
vertex(351, 311.1875);
vertex(353, 318.1875);
vertex(359, 324.1875);
vertex(368, 327.1875);
vertex(377, 326.1875);
vertex(382, 321.1875);
endShape();
  fill(135, 206, 235)
  beginShape();
vertex(363, 409.1875);
vertex(366, 411.1875);
vertex(368, 415.1875);
vertex(370, 419.1875);
vertex(374, 422.1875);
vertex(377, 422.1875);
vertex(382, 422.1875);
vertex(386, 421.1875);
vertex(389, 417.1875);
vertex(392, 411.1875);
vertex(394, 404.1875);
vertex(392, 401.1875);
vertex(390, 398.1875);
vertex(388, 394.1875);
vertex(384, 391.1875);
vertex(380, 389.1875);
vertex(374, 386.1875);
vertex(370, 385.1875);
vertex(365, 383.1875);
vertex(360, 383.1875);
vertex(355, 384.1875);
vertex(349, 386.1875);
vertex(344, 388.1875);
vertex(338, 391.1875);
vertex(334, 395.1875);
vertex(330, 399.1875);
vertex(327, 404.1875);
vertex(323, 409.1875);
vertex(320, 415.1875);
vertex(317, 421.1875);
vertex(316, 427.1875);
vertex(316, 433.1875);
vertex(318, 438.1875);
vertex(322, 441.1875);
vertex(327, 443.1875);
vertex(332, 443.1875);
vertex(337, 441.1875);
vertex(339, 436.1875);
vertex(341, 431.1875);
vertex(343, 425.1875);
vertex(347, 419.1875);
vertex(350, 415.1875);
vertex(354, 412.1875);
vertex(358, 409.1875);
endShape();
}

function drawCrescentMoon() {
  // Dibuix de la lluna creixent
  fill(0);
  ellipse(0, 0, 50, 100); // Lluna plena
  fill('#0d335f');
  ellipse(10, 0, 50, 100); // Ombra per crear la creixent
}

function drawRainbow() {
  // Dibuix d'un arc de Sant Martí
  let radius = 50;
  let colors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#8B00FF']; // Colors de l'arc de Sant Martí

  for (let i = 0; i < colors.length; i++) {
    stroke(colors[i]);
    noFill();
    arc(0, 0, radius + i * 10, radius + i * 10, PI, TWO_PI); // Dibuixar arcs concèntrics amb diferents colors
  }
}

function handleFileUpload(event) {
  let file = event.target.files[0];
  if (file && file.type.startsWith('audio/')) {
    let fileURL = URL.createObjectURL(file);

    // Update Plyr player with the new audio file
    const audioElement = document.getElementById('player');
    audioElement.src = fileURL;
    player.source = {
      type: 'audio',
      sources: [{ src: fileURL, type: file.type }]
    };

    // Load sound for p5.js analysis
    loadSound(fileURL, soundLoaded);
  } else {
    console.error('Please upload a valid audio file');
  }
}

function soundLoaded(loadedSong) {
  if (song && song.isPlaying()) {
    song.stop();
  }
  song = loadedSong;
  song.play();
  amplitude.setInput(song);
  fft.setInput(song);
}
</script>

</body>
</html>
